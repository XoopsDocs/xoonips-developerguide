# 2. 注意事項

ここで紹介する関数は，フォームを生成する関数とデータベースを操作する関数に大別されます．関数は以下の規則で命名されています．

### 1. 関数名の規則

#### 1.1. フォーム生成関数

フォーム生成のための関数名は一部の例外を除き以下の規則に従います．

> ```text
> xnpGet<TYPE><METHOD>Block( 引数 )
> ```

* &lt;TYPE&gt;
  * BasicInformation : アイテム基本情報
  * Index : インデックス
  * Preview : 添付画像
  * Attachment : 添付ファイル
  * TextFile : テキスト\(長文入力\)
  * Rights : ライセンス
* &lt;METHOD&gt;
  * Detail : アイテム詳細表示画面を生成するときに呼び出されます．
  * Confirm : アイテム内容確認画面を生成するときに呼び出されます．
  * Register : アイテム登録画面を生成するときに呼び出されます．
  * Edit : アイテム編集画面を生成するときに呼び出されます．
  * PrinterFriendly : 印刷用画面を生成するときに呼び出されます．\(内部処理はほぼ Detail と同じなので，個々の関数の解説は省略します．\)

上から解かるように，例えばアイテム内容確認画面にインデックスを表示するための関数は xnpGetIndexDetailBlock となります．

#### 1.2. データベース操作関数

アイテムの登録，編集，削除などの操作を行なう関数名は一部の例外を除き以下の規則に従います．

> ```text
> xnp<METHOD><TYPE> ( 引数 )
> ```

* &lt;TYPE&gt;
  * \(フォーム生成関数と同じなので省略\)
* &lt;METHOD&gt;
  * Insert : データベースに情報を登録します．
  * Update : データベースにある情報に上書きします．
  * Delete : データベースから情報を削除します．

※ Update 関数が Insert を兼ねるものもあります．\(Index，Preview など\)

※ Basic Information の削除と同時に Delete を実行するものもあります．\(Preview，Attatchment など\)

### 2. フォーム生成関数の注意事項

* 生成したテキストだけではフォームとして機能しません．

  関数が生成したフォームは &lt;form&gt; タグを含まないことに注意してください．&lt;form&gt; タグの内側に使用できる HTML だけを生成します．従って，生成結果単体ではフォームとして不完全です．関数を呼び出した側で &lt;form&gt; タグを定義して利用してください．

* JavaScript の定義が必要なフォームがあります．

  関数が生成したフォームと &lt;form&gt; タグの定義だけでは動作しないものもあります．JavaScript の定義が必要か否かは関数によって異なります．定義が必要な場合は，その関数の説明の中に JavaScriptが 記載されています． &lt;form&gt; タグの定義とあわせて HTML にその JavaScript を定義してください．

* 生成したフォームは連想配列で出力されます．

  関数は連想配列を返します．連想配列の構造は以下の通りです．

  * &lt;TYPE&gt;がBasicInformationの場合

    > ```text
    > array(
    >     'フィールド名' => array(
    >         'name'=>'表示フィールド名',
    >         'value'=>'表示フィールド値'
    >         'within'=>'フィールド値のDBに書き込める部分'   /* Confirmの場合だけ存在する */
    >         'without'=>'フィールド値のDBに書き込めない部分'   /* Confirmの場合だけ存在する */
    >     ),
    >     (繰り返し) …
    >     'hidden' => '表示hidden値'  /* Detailの場合だけ存在する */
    > )
    > ```

  * &lt;TYPE&gt;がBasicInformation以外の場合

    > ```text
    > array(
    >         'name'=>'表示フィールド名',
    >         'value'=>'表示フィールド値'
    >         'within'=>'フィールド値のDBに書き込める部分'   /* Confirmの場合だけ存在する */
    >         'without'=>'フィールド値のDBに書き込めない部分'   /* Confirmの場合だけ存在する */
    >         'hidden' => '表示hidden値'  /* Detailの場合だけ存在する */
    > )
    > ```

  Basic Information の登録，編集，確認，詳細表示フォームは，タイトル，コメントといったフィールド毎に分割して生成されます．関数を呼び出した側が必要とするフィールドだけを組合せてフォームの形にして利用してください．

  これは，アイテムタイプ作成者がアイテムタイプにとって必要なフィールドだけを選んで登録，編集，閲覧画面を作成するための枠組みです．この枠組みによって，登録画面にタイトルとコメントしかないアイテムタイプも可能になります．

  フィールド名には 'titile', 'keywords' などのフィールドを識別するための内部処理用の文字列が入ります．

  表示フィールド名は画面に出力するためのフィールド名です．表示フィールド値はデータベースや変数で与えられた具体的な値です．登録や編集の場合はフォームの HTML になることもあります．

  &lt;METHOD&gt;がDetailの場合だけ，特別なキー'hidden'があります． この場合，登録画面・編集画面と同じデータを送信するための見えないinputタグが 表示hidden値 として設定されます． 以降の章では特に記述しませんが，全てのxnpGet〜DetailBlockについてこのキーが存在します．

  &lt;METHOD&gt;がConfirmの場合だけ，特別なキー'within' 'without'があります． この場合，'within'にはDBに書き込める部分が、'without'にはDBに書き込めない部分\(DBのカラムサイズによる\)が設定されます． 以降の章では特に記述しませんが，valueが文字列型ならこのキーが存在します．

